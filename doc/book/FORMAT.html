<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Format - Multi Layer Archive</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Multi Layer Archive</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="versioning"><a class="header" href="#versioning">Versioning</a></h1>
<p>Relation between the MLA version and the file format version:</p>
<div class="table-wrapper"><table><thead><tr><th>MLA Version</th><th>Supported file format</th></tr></thead><tbody>
<tr><td>2.0</td><td>2</td></tr>
</tbody></table>
</div>
<h1 id="mla-file-format-v2"><a class="header" href="#mla-file-format-v2">MLA file format v2</a></h1>
<p>This document introduces the MLA file format in its current version, v2.
For a more comprehensive introduction of the ideas behind it, please refer to <a href="README.html">README.md</a>.</p>
<p>Structures marked with #[bincode] below are encoded with <a href="https://docs.rs/bincode/2.0.0/bincode/index.html">bincode</a> in version 2 with fixed-size integer encoding in little endian.</p>
<h2 id="mla-header"><a class="header" href="#mla-header">MLA Header</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct MLA {
    // MLA magic
    magic: [u8; 3] = b"MLA",
    // Current file format version
    #[little_endian]
    format_version: u32 = 2,
    #[bincode]
    struct ArchivePersistentConfig {
        // bitfield indicating which Layer is enabled
        // - ENCRYPT = 0b0000_0001;
        // - COMPRESS = 0b0000_0010;
        layers_enabled: Layers,
        // Optional field, if "encrypt" layer is enabled
        encrypt: Option&lt;struct EncryptionPersistentConfig {
            // HPKE with multi recipient
            recipients: Vec&lt;struct HybridRecipientEncapsulatedKey {
                /// "Ciphertext" for ML-KEM 1024
                ct_ml: [u8; 1568],
                /// "Ciphertext" for DH-KEM (actually an ECC ephemeral public key)
                ct_ecc: [u8; 32],
                /// Wrapped (encrypted) version of the main shared secret
                /// - Algorithm: AES-256-GCM
                /// - Key: per-recipient hybrid shared secret
                /// - Nonce: per-recipient
                wrapped_ss: [u8; 32],
                /// Associated tag
                tag: [u8; 16],
            }&gt;,
            key_commitment: struct KeyCommitmentAndTag {
                key_commitment: [u8; 64],
                tag: [u8; 16],
            }
        }&gt;,
    },
    data: [u8],
}
<span class="boring">}</span></code></pre></pre>
<p>The content of the <code>data</code> field then depend on what layers are enabled, in the following order:</p>
<ol>
<li>Encryption layer</li>
<li>Compression layer</li>
<li>Actual archive entries</li>
</ol>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>For example, on <a href="samples/archive_v2.mla">samples/archive_v2.mla</a>:</p>
<ul>
<li><code>4d 4c 41</code>: <code>magic</code></li>
<li><code>02 00 00 00</code>: <code>format_version</code>, set to 2 for archive format v2</li>
<li><code>03</code>: <code>layers</code>, with <code>ENCRYPT | COMPRESS = 0b11</code>, i.e. Encryption and Compression layers are enabled</li>
<li><code>01</code>: <code>EncryptionPersistentConfig</code> is present, as expected because the corresponding layer ("encrypt") is enabled</li>
<li><code>01 00 00 00 00 00 00 00</code> : there is one recipient</li>
<li><code>a6 (.. 1568-bytes length ..) b8</code>: <code>recipients[0].mlkem_encapsulated_key</code></li>
<li><code>37 (.. 32-bytes length ..) 00</code>: <code>recipients[0].ecc_encapsulated_key</code></li>
<li><code>41 (.. 32-bytes length ..) b3</code>: <code>recipients[0].encrypted_shared_secret</code></li>
<li><code>83 (.. 16-bytes length ..) 51</code>: <code>recipients[0].encrypted_shared_secret_tag</code></li>
<li><code>08 (.. 64-bytes length ..) df</code>: <code>encrypted_key_commitment</code></li>
<li><code>f3 (.. 16-bytes length ..) 26</code>: <code>encrypted_key_commitment_tag</code></li>
<li><code>a3 until EOF</code>: <code>data</code></li>
</ul>
<h2 id="encryption-layer"><a class="header" href="#encryption-layer">Encryption layer</a></h2>
<p>From the information in the header, the cryptographic material is recovered as described in <code>CRYPTO.md</code>. This enables decrypting following content.</p>
<p><code>data</code> is a contiguous list of:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct DataBlock {
    encrypted_content: [u8; 128 * 1024],
    tag: [u8; 16],
}
<span class="boring">}</span></code></pre></pre>
<p>followed by one:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct FinalBlock {
    encrypted_content: [u8; 10],
    tag: [u8; 16],
}
<span class="boring">}</span></code></pre></pre>
<p>The last <code>DataBlock</code> is an exception: <code>encrypted_content</code> might be smaller. Its size is then <code>((data.len() - sizeof(FinalBlock)) % sizeof(DataBlock)) - 16</code>.</p>
<p>To protect from a truncation attack, before using an archive, it must be checked that <code>FinalBlock.tag</code> is correct and that <code>msg_final</code> is <code>FINALBLOCK</code>.</p>
<p>Formats for DER keys (thus PEM keys too) are documented in comments of functions <code>parse_mlakey_privkey_der</code> and <code>parse_mlakey_pubkey_der</code>.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<p>For example, with the private key <a href="samples/test_mlakey_archive_v2.der">samples/test_mlakey_archive_v2.der</a>:</p>
<ul>
<li>The MLA private key ASN.1 DER encoded data is a X25519 private key followed by a ML-KEM 1024 private key</li>
<li>MLA private key X25519 part: <code>5d 58 a8 7c 9c 69 ba 67 4a f9 d3 89 23 76 c9 5e d8 eb 08 cf 09 cd 61 5c 07 28 99 c3 79 45 96 a9</code></li>
<li>MLA private key <code>mlkem_dk</code> (<code>dk_pke||ek||h||z</code>) part: <code>21 f0 (.. 3168-bytes length ..) de 3e</code></li>
</ul>
<p>This gives with <a href="samples/archive_v2.mla">samples/archive_v2.mla</a>:</p>
<ul>
<li><code>ecc_shared_secret</code>: <code>40 1c 7f b9 ba 4a d3 7c 5a 8f a9 7a 6f b4 02 57 22 d6 e9 b2 66 2c 02 cd eb d0 f4 81 0c 14 16 00</code></li>
<li><code>mlkem_shared_secret</code>: <code>6a 92 fa 89 e2 30 57 19 eb 39 52 46 24 06 de 65 30 61 b8 f6 bb 6e 61 63 3c b3 99 d5 f6 a3 95 d0</code></li>
<li><code>combined_shared_secret</code>: <code>ec f2 64 11 18 2e 19 0a 3e da bf 55 51 5f 51 0e 85 ed 3c 66 78 59 f5 7d 78 44 b9 96 41 a1 57 1f</code></li>
<li><code>Per-Recipient Hybrid KEM HPKE base_nonce</code>: <code>cb 7e 1d 35 29 c1 92 a2 71 03 6c 71</code></li>
<li><code>Per-Recipient Hybrid KEM HPKE key</code>: <code>8c 22 67 a9 65 4b d4 c1 45 42 6b e9 4e f1 94 93 d5 e8 ae 83 c2 dd 65 62 a3 82 fa d0 b9 95 d1 79</code></li>
<li><code>Per-Recipient Hybrid KEM decapsulated key</code>: <code>41 14 54 34 3b 09 a9 cd df d7 f0 83 46 63 35 dc f4 89 4b 12 46 06 81 68 6d 1f d0 0e 11 63 3a b3</code></li>
<li><code>Multi-Recipient Hybrid KEM HPKE base_nonce</code>: <code>df d3 f3 74 d1 0e b9 1f 31 ba 6c 09</code></li>
<li><code>Multi-Recipient Hybrid KEM HPKE key</code>: <code>8a a1 b7 a7 ad 5d 8d 07 ae 97 27 93 d5 5b 45 d9 ed dc b3 30 91 93 88 ce f1 19 63 78 0d 32 b0 0b</code></li>
</ul>
<p>These last two elements are those with which HPKE is setup to do AES-256-GCM decryption of the rest of the archive.</p>
<ul>
<li>Now, the decryption process can be started. <code>data</code> length (<code>27273=29044-(sizeof(header)=1745)-(sizeof(FinalBlock)=26)</code>) being smaller than <code>sizeof(DataBlock)</code>, the <code>encrypted_content</code> is 27257-bytes long. The corresponding tag is <code>2e .. 16</code> (which corresponds to the last 16-bytes of <code>data</code> before the <code>FinalBlock</code> ).</li>
</ul>
<p>The first decrypted bytes are <code>9b ff ff 3f 67 54 af 01 03 e7 35 a9 87 88 82 3e ...</code>.</p>
<p>In the next section, <code>data</code> is now the decrypted content (as if the encryption layer was absent).</p>
<h2 id="compression"><a class="header" href="#compression">Compression</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct CompressionLayer {
    // Compressed data, explained below
    compressed_data: [u8],
    // Footer
    #[bincode]
    sizes_info: struct SizesInfo {
        /// Ordered list of chunk compressed sizes; only set at initialization
        compressed_sizes: Vec&lt;u32&gt;,
        /// Last block uncompressed size
        last_block_size: u32,
    }
    // Size of the serialized `sizes_info`
    #[little_endian]
    sizes_info_length: u32
}
<span class="boring">}</span></code></pre></pre>
<p>The compression layer footer information is retrieved by first reading the value of <code>sizes_info_length</code> at the end of <code>data</code>, then reading <code>sizes_info_length</code>-bytes at the end of <code>data</code> minus 4 bytes.</p>
<p><code>compressed_data</code> is a concatenation of <code>compressed_block_i</code> blocks of size <code>compressed_sizes[i]</code>.</p>
<p>A <code>compressed_block_i</code> is a <a href="https://tools.ietf.org/html/rfc7932">brotli compressed</a> block. Its uncompressed data size is <code>4 * 1024 * 1024</code>-bytes, except for the last block (<code>last_block_size</code>).  This format already brings necessary data for decompression, such as the quality level used.</p>
<p>The resulting data is the concatenation of all decompressed <code>compressed_block_i</code>.</p>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<p>For example, on <a href="samples/archive_v2.mla">samples/archive_v2.mla</a>, after decryption:</p>
<ul>
<li>Reading from the end of <code>data</code> leads to <code>sizes_info_length = 24</code></li>
<li>The corresponding <code>SizesInfo</code> is:</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>SizesInfo {
    compressed_sizes: [
        13333,
        259,
        13637,
    ],
    last_block_size: 3209403,
}
<span class="boring">}</span></code></pre></pre>
<p>It indeed corresponds to the size of <code>data</code>: <code>data.len() = 27257 = 13333 + 259 + 13637 + 24 + 4</code>. The decompressed size is then <code>decompressed.len() = 2 * (4 * 1024 * 1024) + 3209403</code>.</p>
<ul>
<li>Each block can now be decompressed</li>
</ul>
<p>The first decompressed bytes are <code>00 00 00 00 00 00 00 00 00 06 00 00 00 00 00 00 00 73 69 6d 70 6c 65 01 00 00 00 00 00 00 00 00</code>.</p>
<p>In the next section, <code>data</code> is now the decompressed content (as if the compression layer was absent).</p>
<h2 id="entries-names"><a class="header" href="#entries-names">Entries names</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[bincode]
struct EntryName {
    name: Vec&lt;u8&gt;
}
<span class="boring">}</span></code></pre></pre>
<p>These names are described in <code>doc/ENTRY_NAME.md</code></p>
<h2 id="actual-archive-entries-data"><a class="header" href="#actual-archive-entries-data">Actual archive entries data</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ArchiveContent {
    // Data content, explained below
    entry_data: [u8]
    // Footer
    #[bincode]
    struct ArchiveFooter {
        // EntryName -&gt; Corresponding EntryInfo
        entries_info: Vec&lt;(EntryName, struct EntryInfo {
            // Offsets of continuous chunks of `ArchiveEntryBlock`
            offsets: Vec&lt;u64&gt;,
            // Size of the `entry_data`, in bytes
            size: u64,
            // Offset of the ArchiveEntryBlock::EndOfEntry
            eof_offset: u64,
        })&gt;,
    },
    // Size of the serialized `ArchiveFooter`
    #[little_endian]
    archive_footer_length: u64
}
<span class="boring">}</span></code></pre></pre>
<p>The archive footer information is optionally retrieved by first reading the value of <code>archive_footer_length</code> at the end of <code>data</code>, then reading <code>archive_footer_length</code>-bytes at the end of <code>data</code> minus 8 bytes.</p>
<p><code>entry_data</code> is the concatenation of all <code>ArchiveEntryBlock</code>s. Each block starts with a <code>u8</code> corresponding to the block type:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum ArchiveEntryBlockType {
    EntryStart = 0x00,
    EntryContent = 0x01,

    EndOfArchiveData = 0xFE,
    EndOfEntry = 0xFF,
}
<span class="boring">}</span></code></pre></pre>
<p>Then, depending on the block type:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct EntryStart {
    // entry unique ID in the archive
    #[little_endian]
    id: u64,
    // entry name
    name: EntryName
}

struct EntryContent {
    // entry unique ID in the archive
    #[little_endian]
    id: u64,
    // Length of the block_data
    #[little_endian]
    length: u64,
    // Content
    block_data: [u8; length]
}

struct EndOfEntry {
    // Entry unique ID in the archive
    #[little_endian]
    id: u64,
    // SHA-256 of the entry content
    hash: [u8; 32]
}

struct EndOfArchiveData {}
<span class="boring">}</span></code></pre></pre>
<p>An entry <code>entry_i</code> in the archive always starts with an <code>EntryStart</code>, giving its name and unique ID.</p>
<p>Let <code>content_i</code> be the content of <code>entry_i</code>. It starts empty.</p>
<p>Each time a <code>EntryContent</code> is encountered, the corresponding <code>block_data</code> is appended to <code>content_i</code>.</p>
<p>Once the <code>EndOfEntry</code> for <code>entry_i</code> is reached, the entry is completely read. Its content SHA-256 hash can be verified with the <code>EndOfEntry.hash</code>.</p>
<p>Between the last <code>EndOfEntry</code> block and the beginning of the <code>ArchiveFooter</code>, there is the only <code>EndOfArchiveData</code> block. It is used in the repair process, to correctly separate the actual archive data from the footer.</p>
<p>As blocks from different entries can be interleaved, the <code>entries_info.offsets</code> are the offsets in <code>entry_data</code> of blocks for the same entry.</p>
<p>For instance, if the blocks are:</p>
<pre><code>Off0: [EntryStart ID 1]
Off1: [EntryStart ID 2]
Off2: [EntryContent ID 1]
Off3: [EntryContent ID 1]
Off4: [EntryContent ID 2]
Off5: [EndOfEntry ID 1]
...
</code></pre>
<p>The <code>offsets</code> for the entry with ID 1 will be <code>Off0</code>, <code>Off2</code>, <code>Off5</code>.
Additionally, for faster <code>hash</code> retrieval, <code>entries_info.eof_offset</code> is the offset of the <code>EndOfEntry</code> block for the corresponding entry. In this example, <code>eof_offset = Off5</code> for ID 1.</p>
<p>Finally, the <code>entries_info.size</code> is the size in bytes of the corresponding entry content.</p>
<p>For reproducibility, the <code>entries_info</code> <code>Vec</code> is sorted by entry name (lexicographically by bytes values) before being serialized.</p>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<p>For example, on <a href="samples/archive_v2.mla">samples/archive_v2.mla</a>, after decryption and decompression:</p>
<ul>
<li>Reading from the end of <code>data</code> leads to <code>archive_footer_length = 18444</code></li>
<li>The corresponding <code>ArchiveFooter</code> is (observed order may be different if deserialized into a HashMap):</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>ArchiveFooter {
    entries_info: {
        "big": EntryInfo {
            offsets: [
                1074403,
            ],
            size: 10485760,
            eof_offset: 11560200,
        },
        "file_0": EntryInfo {
            offsets: [
                337,
                19122,
                1074362,
            ],
            size: 4096,
            eof_offset: 1074362,
        },
        ...
        "simple": EntryInfo {
                        offsets: [
                            0,
                        ],
                        size: 256,
                        eof_offset: 296,
                    },
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Let's start reading the first entry of the archive. For easier reading, here is an excerpt of the first 400 bytes of <code>data</code>:</p>
<pre><code>0000  00 00 00 00 00 00 00 00 00 06 00 00 00 00 00 00   ................
0010  00 73 69 6d 70 6c 65 01 00 00 00 00 00 00 00 00   .simple.........
0020  00 01 00 00 00 00 00 00 00 01 02 03 04 05 06 07   ................
0030  08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17   ................
0040  18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27   ........ !"#$%&amp;'
0050  28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37   ()*+,-./01234567
0060  38 39 3a 3b 3c 3d 3e 3f 40 41 42 43 44 45 46 47   89:;&lt;=&gt;?@ABCDEFG
0070  48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57   HIJKLMNOPQRSTUVW
0080  58 59 5a 5b 5c 5d 5e 5f 60 61 62 63 64 65 66 67   XYZ[\]^_`abcdefg
0090  68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 76 77   hijklmnopqrstuvw
00a0  78 79 7a 7b 7c 7d 7e 7f 80 81 82 83 84 85 86 87   xyz{|}~.........
00b0  88 89 8a 8b 8c 8d 8e 8f 90 91 92 93 94 95 96 97   ................
00c0  98 99 9a 9b 9c 9d 9e 9f a0 a1 a2 a3 a4 a5 a6 a7   ................
00d0  a8 a9 aa ab ac ad ae af b0 b1 b2 b3 b4 b5 b6 b7   ................
00e0  b8 b9 ba bb bc bd be bf c0 c1 c2 c3 c4 c5 c6 c7   ................
00f0  c8 c9 ca cb cc cd ce cf d0 d1 d2 d3 d4 d5 d6 d7   ................
0100  d8 d9 da db dc dd de df e0 e1 e2 e3 e4 e5 e6 e7   ................
0110  e8 e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7   ................
0120  f8 f9 fa fb fc fd fe ff ff 00 00 00 00 00 00 00   ................
0130  00 40 af f2 e9 d2 d8 92 2e 47 af d4 64 8e 69 67   .@.......G..d.ig
0140  49 71 58 78 5f bd 1d a8 70 e7 11 02 66 bf 94 48   IqXx_...p...f..H
0150  80 00 01 00 00 00 00 00 00 00 06 00 00 00 00 00   ................
0160  00 00 66 69 6c 65 5f 30 00 02 00 00 00 00 00 00   ..file_0........
0170  00 06 00 00 00 00 00 00 00 66 69 6c 65 5f 31 00   .........file_1.
0180  03 00 00 00 00 00 00 00 06 00 00 00 00 00 00 00   ................
</code></pre>
<ul>
<li><code>00</code>: mark a <code>EntryStart</code> block</li>
<li><code>00 00 00 00 00 00 00 00</code>: entry ID is 0</li>
<li><code>06 00 00 00 00 00 00 00</code>: name length, in bytes, is 6</li>
<li><code>73 69 6d 70 6c 65</code>: the name is "simple"</li>
<li><code>01</code>: mark a <code>EntryContent</code> block</li>
<li><code>00 00 00 00 00 00 00 00</code>: corresponding entry ID is 0 (ie, the entry "simple")</li>
<li><code>00 01 00 00 00 00 00 00</code>: this block contains 0x100 bytes of data</li>
<li><code>00 .. (256-bytes long) .. ff</code>: actual 256 first bytes of "simple"</li>
<li><code>ff</code>: mark a <code>EndOfEntry</code> block</li>
<li><code>00 00 00 00 00 00 00 00</code>: entry ID is 0. The entry "simple" has been fully recovered</li>
<li><code>40 .. (32-bytes long) .. 80</code>: SHA256 hash of the entry "simple" content, ie <code>SHA256(00 01 02 .. FE FF)</code></li>
</ul>
<p>Here, the entry "simple" has been fully recovered. If one continues, there are:</p>
<ul>
<li>A <code>EntryStart</code> block for the entry "file_0" with ID 1</li>
<li>A <code>EntryStart</code> block for the entry "file_1" with ID 2</li>
<li>A <code>EntryStart</code> block with ID 3 for a name of length 6, incomplete in the excerpt</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="DESIGN.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ENTRY_NAME.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="DESIGN.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ENTRY_NAME.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
